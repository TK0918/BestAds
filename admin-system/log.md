# 修改日志

## 2024-03-12 - 修复工具提示显示问题

### 修改内容
- 修复工具提示被其他元素遮挡的问题
- 将工具提示改为fixed定位，避免被表格容器的overflow裁剪
- 添加JavaScript动态计算工具提示位置，确保正确显示
- 增加z-index到99999，确保工具提示显示在最上层
- 添加窗口滚动时的位置更新逻辑
- 添加上方空间不足时显示在下方的自适应逻辑

### 技术实现
- 使用position: fixed定位工具提示
- 使用getBoundingClientRect()动态计算位置
- 监听mouseenter和scroll事件更新位置
- 工具提示样式：深色背景、白色文字、带箭头指向

---

## 2024-03-12 - 优化表头说明显示方式

### 修改内容
- 表头说明文字改为小问号图标交互方式，鼠标悬停显示
- 统计日期、商户ID、客户名称、期初收款、期初充值、期初消耗、期初其他费用字段不显示说明
- 收款总额、充值总额、消耗总额、本月收款、本月充值、本月消耗、累计未充值余额、累计消耗余额字段添加问号图标和工具提示

### 技术实现
- 使用CSS实现工具提示（tooltip）效果
- 鼠标悬停时显示详细说明
- 工具提示样式：深色背景、白色文字、带箭头指向

---

## 2024-03-12 - 调整日报列表字段和表头说明

### 修改内容
- 根据PRD要求调整日报列表字段顺序和名称
- 表头增加字段类型和计算说明文字
- 新增字段：期初收款、期初充值、期初消耗、期初其他费用
- 调整字段名称：应收总额→收款总额，本月应收→本月收款
- 替换字段：累计未付账单金额→累计未充值余额，累计付账单数→累计消耗余额

### 更新的字段列表
1. 统计日期（日期）
2. 商户ID（文本）
3. 客户名称（文本）
4. 期初收款（有期初: 直接展示，无期初: 0）
5. 期初充值（有期初: 直接展示，无期初: 0）
6. 期初消耗（有期初: 直接展示，无期初: 0）
7. 期初其他费用（有期初: 直接展示，无期初: 0）
8. 收款总额（有期初/无期初的计算公式）
9. 充值总额（有期初/无期初的计算公式）
10. 消耗总额（有期初/无期初的计算公式）
11. 本月收款（计算公式）
12. 本月充值（计算公式）
13. 本月消耗（计算公式）
14. 累计未充值余额（计算公式）
15. 累计消耗余额（计算公式）

### 修改的文件
- `admin-system/reports/customer-reconciliation-daily-report.html`

---

## 2024-03-12 - 新增期初其他费用字段

### 修改内容
- 在期初数据设定Tab中新增"期初其他费用"字段
- 字段要求与期初收款一致：支持正负值，保留两位小数，四舍五入

### 更新的功能
1. **模板下载**：CSV模板中增加"期初其他费用"列
2. **批量上传**：
   - 文件解析时处理期初其他费用字段（第6列）
   - 数据验证规则与期初收款一致
   - 预览表格中显示期初其他费用
3. **编辑功能**：
   - 编辑弹窗中增加期初其他费用输入框
   - 保存时包含期初其他费用数据
4. **列表展示**：表格中增加期初其他费用列
5. **数据初始化**：示例数据中包含期初其他费用字段

### 修改的文件
- `admin-system/reports/customer-reconciliation-daily-report.html`

---

## 2024-03-12 - 新增客户对账日报功能

### 新增文件
- `admin-system/reports/customer-reconciliation-daily-report.html` - 客户对账日报页面

### 功能实现

#### Tab1: 日报页面
- 筛选功能：商户ID（模糊搜索）、客户名称（模糊搜索）、统计日期（默认昨天）
- 数据统计表格展示：
  - 统计日期、商户ID、客户名称
  - 应收总额、充值总额、消耗总额
  - 本月应收、本月充值、本月消耗
  - 累计未付账单金额、累计付账单数
- 导出Excel功能

#### Tab2: 期初数据设定页面
- 筛选功能：商户ID（模糊搜索）、客户名称（模糊搜索）
- 列表展示：
  - 商户ID、客户名称
  - 期初应收款、期初充值、期初消耗（支持正负值，保留两位小数）
  - 期初日期、修改人、最后修改时间
  - 操作（编辑、删除）
- 模板下载功能：下载CSV格式的批量上传模板
- 批量上传功能：
  - 支持CSV、XLSX、XLS格式文件
  - 文件解析和数据验证
  - 预览上传效果（显示总条数、有效条数、失败原因）
  - 数据验证规则：
    - 商户ID必填，需判断是否存在
    - 期初应收、期初充值、期初消耗支持正负值，保留两位小数，四舍五入
    - 期初日期格式：年-月-日
  - 覆盖已存在数据的处理
  - 只上传有效数据
- 单条编辑功能：
  - 支持修改期初收款、期初充值、期初消耗、期初日期
  - 商户ID字段为只读，不允许修改
  - 保存后更新修改人和最后修改时间
  - 提示：保存成功后，期初数据会应用到下次统计任务中，历史数据不更新
- 导出功能：导出当前已设定的期初数据
- 删除功能：二次确认删除，删除后下次统计不使用期初数据

### 更新的文件
更新了所有报表文件的侧边栏菜单，添加"客户对账日报"链接：
- `admin-system/reports/customer-recharge-report.html`
- `admin-system/reports/account-recharge-report.html`
- `admin-system/reports/account-consume-report.html`
- `admin-system/reports/negative-ad-report.html`
- `admin-system/reports/report1.html`
- `admin-system/reports/recharge-distribution-report.html`
- `admin-system/reports/profit-fluctuation-report.html`
- `admin-system/reports/data-report.html`
- `admin-system/reports/customer-fund-change-report.html`
- `admin-system/reports/consume-analysis-report.html`

### 技术实现
- 使用Tailwind CSS进行样式设计
- 使用FontAwesome图标库
- 响应式设计，支持移动端和桌面端
- Tab切换功能
- 模态框交互（批量上传、编辑、删除确认）
- CSV文件解析和数据验证
- 数据格式化显示（货币格式、日期格式）
- 通知提示功能

