# 修改日志

## 2024-03-XX - 调整其他扣费页面功能

### 修改内容
- 页面名称从"扣费明细"改为"其他扣费"
- 移除扣费状态筛选和显示（提交即成功）
- 新增其他扣费时：
  - 商户ID改为下拉选择
  - 移除扣费时间输入（提交时自动记录当前时间）
  - 移除关联订单号字段
  - 添加备注字段（选填）
  - 选择商户后自动显示商户资金信息（默认币种、真实金额、预充金额、信用额度、已用额度、可用余额）
  - 扣费金额验证：必须小于等于可用余额
- 列表字段调整：
  - 移除"扣费状态"列
  - "关联订单号"改为"备注"

### 修改的文件
- `admin-system/main-functions/deduction-details.html` - 调整页面功能和字段
- `admin-system/main-functions/index.html` - 更新菜单名称

---

## 2024-03-XX - 调整系统配置页面结构

### 修改内容
- 将`deduction-config.html`重命名为`system-config.html`
- 页面标题改为"系统配置"
- 添加Tab结构，Tab名称为"扣费类型枚举"
- 将列表中的"创建时间"字段改为"更新时间"
- 每次更新数据（编辑、启用/禁用）时自动更新"更新时间"字段
- 菜单位置调整：从"系统设置"菜单移动到"主要功能"菜单下

### 修改的文件
- `admin-system/main-functions/system-config.html` - 新增系统配置页面（带Tab结构）
- `admin-system/main-functions/index.html` - 更新菜单，在"主要功能"下添加"系统配置"链接
- `admin-system/main-functions/deduction-details.html` - 更新菜单链接
- `admin-system/main-functions/deduction-config.html` - 已删除（已重命名为system-config.html）

---

## 2024-03-XX - 新增其他费用扣费功能（V2.8）

### 新增文件
- `admin-system/main-functions/deduction-details.html` - 扣费明细页面
- `admin-system/main-functions/system-config.html` - 系统配置页面（扣费类型枚举Tab）

### 功能实现

#### 扣费明细页面（deduction-details.html）
**功能**：
- 新增扣费：创建扣费记录，选择商户ID、扣费类型、扣费金额、扣费时间、关联订单号
- 查看扣费明细：列表展示已扣费记录
- 导出：导出扣费明细数据

**列表字段**：
- 商户ID
- 扣费时间
- 扣费类型（账户扣费、账户充值、广告投放、渠道返点、媒体合作、其他费用）
- 扣费金额
- 扣费状态（扣费成功/扣费失败）
- 关联订单号
- 操作人

**筛选功能**：
- 商户ID（模糊搜索）
- 扣费类型（下拉选择）
- 扣费状态（下拉选择）
- 扣费时间范围（开始时间、结束时间）

**分页功能**：
- 支持每页显示10/20/50/100条
- 分页导航

#### 系统配置页面（system-config.html）
**页面结构**：
- 页面标题：系统配置
- Tab结构：扣费类型枚举

**扣费类型枚举Tab功能**：
- 新增扣费项：创建新的扣费类型
- 编辑扣费项：修改扣费项名称
- 启用/禁用扣费项：控制扣费项是否可用

**列表字段**：
- ID
- 扣费项名称
- 状态（启用/禁用）
- 更新时间（每次更新数据时自动更新）
- 操作人
- 操作（编辑、启用/禁用）

**状态管理**：
- 启用 ↔ 禁用（双向切换）
- 切换前二次确认

### 更新的文件
- `admin-system/main-functions/index.html` - 在"主要功能"菜单中添加"扣费明细"链接，在"系统设置"菜单中添加"扣费项配置"链接

### 技术实现
- 使用Tailwind CSS进行样式设计
- 使用FontAwesome图标库
- 响应式设计，支持移动端和桌面端
- 模态框交互（新增、编辑）
- 数据格式化显示（货币格式、日期格式）
- 状态标签样式（成功/失败、启用/禁用）
- 分页功能
- 筛选和搜索功能

### 需求说明
根据PRD文档V2.8需求实现：
- 功能范围：仅用于调整广告主钱包余额，不涉及代理商和广告投放
- 扣费标识：通过扣费类型（扣费项）明确扣费原因
- 数据字段：使用商户ID作为核心标识字段
- 流程简化：广告运营系统直接发起扣费，无需多系统交互

---

## 2024-03-XX - 优化预充配置批量上传交互流程

### 修改内容
- 优化批量上传功能：选择文件后自动解析文件内容，无需再点击"解析内容"按钮
- 移除"解析内容"按钮，简化用户操作流程
- 文件选择后自动进入预览步骤，提升用户体验
- 修复bug：移除对已删除的parseBtn按钮的引用，修复批量上传按钮无响应的问题

### 修改的文件
- `admin-system/system-configuration/precharge-config.html` - 优化文件选择和解析流程，修复代码错误

---

## 2024-03-XX - 更新仪表盘页面支持预充配置跳转

### 修改内容
- 在仪表盘页面（index.html）的侧边栏"系统设置"菜单中，将"系统配置"链接更新为指向预充配置页面

### 修改的文件
- `admin-system/main-functions/index.html` - 更新侧边栏"系统配置"链接指向 `../system-configuration/precharge-config.html`

---

## 2024-03-XX - 新增预充配置页面

### 新增文件
- `admin-system/system-configuration/precharge-config.html` - 预充配置页面

### 功能实现

#### 筛选项
- 商户ID（模糊搜索）
- 客户名称（模糊搜索）

#### 列表展示字段
- 商户ID、客户名称
- 历史充值($)、历史消耗($)、带来总利润($)
- 利润截止日期、预充比例(%)、预充金额上限($)
- 最后修改人、最后修改时间
- 操作（编辑）

#### 新增功能
- 弹窗选择商户，输入历史充值、历史消耗、带来总利润、利润截止日期、预充比例
- 限制：
  - 已存在的商户ID不能重复选择
  - 预充比例单位%，值必须>0且<=100，保留2位小数
- 保存后自动计算预充金额上限

#### 编辑功能
- 可编辑字段：历史充值、历史消耗、带来总利润、预充比例（4个字段）
- 商户ID和客户名称为只读
- 保存后自动更新：预充金额上限、最后修改人、最后修改时间（3个字段）

#### 下载模板功能
- 下载CSV格式模板
- 包含字段：商户ID、历史充值($)、历史消耗($)、带来总利润($)、利润截止日期、预充比例(%)

#### 批量上传功能
- 支持CSV、XLSX、XLS格式文件
- 上传流程：上传文件 → 解析内容 → 预览内容 → 确认上传
- 预览表格显示：
  - 商户ID、客户名称、历史充值($)、历史消耗($)、带来总利润($)、利润截止日期、预充比例(%)
  - 数据处理（新增/覆盖）、数据有效性（有效/无效）、原因
- 数据验证规则：
  - 商户ID必填，需判断是否存在
  - 历史充值/历史消耗/带来总利润金额数值异常检查
  - 预充比例数值异常检查（0.01-100.00）
  - 利润截止日期格式验证（年-月-日）
- 只上传标记为"有效"的数据
- 覆盖已存在数据的处理

### 技术实现
- 使用Tailwind CSS进行样式设计
- 使用FontAwesome图标库
- 响应式设计，支持移动端和桌面端
- 模态框交互（新增、编辑、批量上传）
- CSV文件解析和数据验证
- 数据格式化显示（货币格式、日期格式）
- 步骤指示器显示上传进度

---

## 2024-03-12 - 修复工具提示显示问题

### 修改内容
- 修复工具提示被其他元素遮挡的问题
- 将工具提示改为fixed定位，避免被表格容器的overflow裁剪
- 添加JavaScript动态计算工具提示位置，确保正确显示
- 增加z-index到99999，确保工具提示显示在最上层
- 添加窗口滚动时的位置更新逻辑
- 添加上方空间不足时显示在下方的自适应逻辑

### 技术实现
- 使用position: fixed定位工具提示
- 使用getBoundingClientRect()动态计算位置
- 监听mouseenter和scroll事件更新位置
- 工具提示样式：深色背景、白色文字、带箭头指向

---

## 2024-03-12 - 优化表头说明显示方式

### 修改内容
- 表头说明文字改为小问号图标交互方式，鼠标悬停显示
- 统计日期、商户ID、客户名称、期初收款、期初充值、期初消耗、期初其他费用字段不显示说明
- 收款总额、充值总额、消耗总额、本月收款、本月充值、本月消耗、累计未充值余额、累计消耗余额字段添加问号图标和工具提示

### 技术实现
- 使用CSS实现工具提示（tooltip）效果
- 鼠标悬停时显示详细说明
- 工具提示样式：深色背景、白色文字、带箭头指向

---

## 2024-03-12 - 调整日报列表字段和表头说明

### 修改内容
- 根据PRD要求调整日报列表字段顺序和名称
- 表头增加字段类型和计算说明文字
- 新增字段：期初收款、期初充值、期初消耗、期初其他费用
- 调整字段名称：应收总额→收款总额，本月应收→本月收款
- 替换字段：累计未付账单金额→累计未充值余额，累计付账单数→累计消耗余额

### 更新的字段列表
1. 统计日期（日期）
2. 商户ID（文本）
3. 客户名称（文本）
4. 期初收款（有期初: 直接展示，无期初: 0）
5. 期初充值（有期初: 直接展示，无期初: 0）
6. 期初消耗（有期初: 直接展示，无期初: 0）
7. 期初其他费用（有期初: 直接展示，无期初: 0）
8. 收款总额（有期初/无期初的计算公式）
9. 充值总额（有期初/无期初的计算公式）
10. 消耗总额（有期初/无期初的计算公式）
11. 本月收款（计算公式）
12. 本月充值（计算公式）
13. 本月消耗（计算公式）
14. 累计未充值余额（计算公式）
15. 累计消耗余额（计算公式）

### 修改的文件
- `admin-system/reports/customer-reconciliation-daily-report.html`

---

## 2024-03-12 - 新增期初其他费用字段

### 修改内容
- 在期初数据设定Tab中新增"期初其他费用"字段
- 字段要求与期初收款一致：支持正负值，保留两位小数，四舍五入

### 更新的功能
1. **模板下载**：CSV模板中增加"期初其他费用"列
2. **批量上传**：
   - 文件解析时处理期初其他费用字段（第6列）
   - 数据验证规则与期初收款一致
   - 预览表格中显示期初其他费用
3. **编辑功能**：
   - 编辑弹窗中增加期初其他费用输入框
   - 保存时包含期初其他费用数据
4. **列表展示**：表格中增加期初其他费用列
5. **数据初始化**：示例数据中包含期初其他费用字段

### 修改的文件
- `admin-system/reports/customer-reconciliation-daily-report.html`

---

## 2024-03-12 - 新增客户对账日报功能

### 新增文件
- `admin-system/reports/customer-reconciliation-daily-report.html` - 客户对账日报页面

### 功能实现

#### Tab1: 日报页面
- 筛选功能：商户ID（模糊搜索）、客户名称（模糊搜索）、统计日期（默认昨天）
- 数据统计表格展示：
  - 统计日期、商户ID、客户名称
  - 应收总额、充值总额、消耗总额
  - 本月应收、本月充值、本月消耗
  - 累计未付账单金额、累计付账单数
- 导出Excel功能

#### Tab2: 期初数据设定页面
- 筛选功能：商户ID（模糊搜索）、客户名称（模糊搜索）
- 列表展示：
  - 商户ID、客户名称
  - 期初应收款、期初充值、期初消耗（支持正负值，保留两位小数）
  - 期初日期、修改人、最后修改时间
  - 操作（编辑、删除）
- 模板下载功能：下载CSV格式的批量上传模板
- 批量上传功能：
  - 支持CSV、XLSX、XLS格式文件
  - 文件解析和数据验证
  - 预览上传效果（显示总条数、有效条数、失败原因）
  - 数据验证规则：
    - 商户ID必填，需判断是否存在
    - 期初应收、期初充值、期初消耗支持正负值，保留两位小数，四舍五入
    - 期初日期格式：年-月-日
  - 覆盖已存在数据的处理
  - 只上传有效数据
- 单条编辑功能：
  - 支持修改期初收款、期初充值、期初消耗、期初日期
  - 商户ID字段为只读，不允许修改
  - 保存后更新修改人和最后修改时间
  - 提示：保存成功后，期初数据会应用到下次统计任务中，历史数据不更新
- 导出功能：导出当前已设定的期初数据
- 删除功能：二次确认删除，删除后下次统计不使用期初数据

### 更新的文件
更新了所有报表文件的侧边栏菜单，添加"客户对账日报"链接：
- `admin-system/reports/customer-recharge-report.html`
- `admin-system/reports/account-recharge-report.html`
- `admin-system/reports/account-consume-report.html`
- `admin-system/reports/negative-ad-report.html`
- `admin-system/reports/report1.html`
- `admin-system/reports/recharge-distribution-report.html`
- `admin-system/reports/profit-fluctuation-report.html`
- `admin-system/reports/data-report.html`
- `admin-system/reports/customer-fund-change-report.html`
- `admin-system/reports/consume-analysis-report.html`

### 技术实现
- 使用Tailwind CSS进行样式设计
- 使用FontAwesome图标库
- 响应式设计，支持移动端和桌面端
- Tab切换功能
- 模态框交互（批量上传、编辑、删除确认）
- CSV文件解析和数据验证
- 数据格式化显示（货币格式、日期格式）
- 通知提示功能

---

## 2024-03-XX - 创建 UI 风格提取指南

### 新增文件
- `admin-system/UI风格提取指南.md` - UI 风格提取与应用完整指南

### 功能说明
创建了详细的 UI 风格提取指南，帮助用户将 BestAds Admin 系统的 UI 风格应用到其他 Cursor 项目中。

### 指南内容
1. **UI 风格概述**：介绍设计特点和配色方案
2. **技术栈分析**：列出所有外部依赖和核心 CSS 类
3. **提取步骤**：详细的 6 步提取流程
   - 创建文件夹结构
   - 提取核心 CSS 样式
   - 提取侧边栏 HTML 结构
   - 提取 JavaScript 交互逻辑
   - 提取顶部栏 HTML 结构
   - 创建完整的基础布局模板
4. **应用到新项目**：提供三种方法（直接复制、NPM 包、Git Submodule）
5. **使用示例**：创建新页面和自定义样式的示例
6. **检查清单**：确保正确应用的验证项
7. **常见问题**：FAQ 和解决方案

### 核心组件
- **CSS 样式**：侧边栏、状态标签、动画效果、响应式设计
- **HTML 结构**：侧边栏、顶部栏、基础布局模板
- **JavaScript**：菜单折叠、移动端切换、响应式处理

### 技术栈
- Tailwind CSS（CDN）
- Font Awesome 6.4.0（图标库）
- Inter 字体（Google Fonts）
- 自定义 CSS 动画和过渡效果

