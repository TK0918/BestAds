<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>账户分配 - BestAds运营系统</title>
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .mobile-menu-open {
            transform: translateX(0);
        }
        
        .mobile-menu-closed {
            transform: translateX(-100%);
        }
        
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .table-hover tbody tr:hover {
            background-color: #f8fafc;
        }
        
        /* 表格容器样式 */
        .table-container {
            position: relative;
            overflow-x: auto;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }
        
        .fixed-table {
            min-width: 800px;
        }
        

    </style>
</head>
<body class="bg-gray-50">
  <div class="flex h-screen overflow-hidden">
    <!-- 侧边栏 -->
    <aside id="sidebar" class="bg-white w-64 min-h-screen shadow-lg transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0 mobile-menu-closed lg:mobile-menu-open fixed z-30">
      <!-- 侧边栏头部 -->
      <div class="flex items-center justify-center h-16 border-b border-gray-200">
        <div class="flex items-center">
          <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
            <i class="fas fa-chart-line text-white text-sm"></i>
          </div>
          <span class="ml-3 text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
            BestAds Admin
          </span>
        </div>
      </div>

      <!-- 侧边栏菜单 -->
      <nav class="mt-8">
        <!-- 主要功能 -->
        <div class="px-4 mb-6">
          <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">主要功能</h3>
          <ul class="space-y-1">
            <li>
              <a href="index.html" class="sidebar-item flex items-center px-4 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 hover:text-gray-900">
                <i class="fas fa-chart-bar w-5 h-5 mr-3 text-gray-400"></i>
                仪表盘
              </a>
            </li>
            <li>
              <a href="customer-management.html" class="sidebar-item flex items-center px-4 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 hover:text-gray-900">
                <i class="fas fa-users w-5 h-5 mr-3 text-gray-400"></i>
                客户管理
              </a>
            </li>
          </ul>
        </div>

        <!-- FB业务管理 -->
        <div class="px-4 mb-6">
          <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">FB业务管理</h3>
          <ul class="space-y-1">
            <li>
              <a href="account-management.html" class="sidebar-item flex items-center px-4 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 hover:text-gray-900">
                <i class="fas fa-sync w-5 h-5 mr-3 text-gray-400"></i>
                账户管理
              </a>
            </li>
            <li>
              <a href="account-opening.html" class="sidebar-item flex items-center px-4 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 hover:text-gray-900">
                <i class="fas fa-plus-circle w-5 h-5 mr-3 text-gray-400"></i>
                开户管理
              </a>
            </li>
            <li>
              <a href="account-allocation.html" class="sidebar-item active flex items-center px-4 py-2 text-sm font-medium text-gray-900 rounded-lg hover:bg-gray-100">
                <i class="fas fa-clipboard-list w-5 h-5 mr-3 text-gray-500"></i>
                账户分配
              </a>
            </li>
            <li>
              <a href="#" class="sidebar-item flex items-center px-4 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 hover:text-gray-900">
                <i class="fas fa-dollar-sign w-5 h-5 mr-3 text-gray-400"></i>
                充值管理
              </a>
            </li>
          </ul>
        </div>

        <!-- 客户流水 -->
        <div class="px-4 mb-6">
          <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">客户流水</h3>
          <ul class="space-y-1">
            <li><a href="customer-transactions/transaction-detail.html" class="menu-link">交易明细</a></li>
            <li><a href="customer-transactions/online-recharge.html" class="menu-link">在线充值</a></li>
            <li><a href="customer-transactions/offline-transfer.html" class="menu-link">线下转账</a></li>
          </ul>
        </div>

        <!-- 系统设置 -->
        <div class="px-4">
          <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">系统设置</h3>
          <ul class="space-y-1">
            <li>
              <a href="#" class="sidebar-item flex items-center px-4 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 hover:text-gray-900">
                <i class="fas fa-cog w-5 h-5 mr-3 text-gray-400"></i>
                系统配置
              </a>
            </li>
            <li>
              <a href="#" class="sidebar-item flex items-center px-4 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-100 hover:text-gray-900">
                <i class="fas fa-user-cog w-5 h-5 mr-3 text-gray-400"></i>
                用户管理
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </aside>

    <!-- 遮罩层 (移动端) -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-gray-600 bg-opacity-50 opacity-0 hidden z-20 transition-opacity duration-300 ease-linear lg:hidden"></div>

    <!-- 主要内容区域 -->
    <div class="flex flex-col flex-1 overflow-hidden">
      <!-- 顶部栏 -->
      <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="flex items-center justify-between h-16 px-4 sm:px-6 lg:px-8">
          <!-- 左侧 -->
          <div class="flex items-center">
            <button onclick="toggleSidebar()" class="lg:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500">
              <i class="fas fa-bars text-lg"></i>
            </button>
            
            <div class="ml-4 lg:ml-0">
              <nav class="flex space-x-2 text-sm" aria-label="Breadcrumb">
                <span class="text-gray-500">主页</span>
                <i class="fas fa-chevron-right text-gray-300 text-xs mt-0.5"></i>
                <span class="text-gray-500">FB业务管理</span>
                <i class="fas fa-chevron-right text-gray-300 text-xs mt-0.5"></i>
                <span class="text-gray-900 font-medium">账户分配</span>
              </nav>
            </div>
          </div>
          
          <!-- 右侧 -->
          <div class="flex items-center space-x-4">
            <div class="relative">
              <button class="p-2 text-gray-400 hover:text-gray-500 relative">
                <i class="fas fa-bell text-lg"></i>
                <span class="absolute -top-1 -right-1 h-4 w-4 bg-red-500 rounded-full flex items-center justify-center text-xs text-white">3</span>
              </button>
            </div>
            
            <div class="flex items-center space-x-3">
              <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                <span class="text-white text-sm font-medium">A</span>
              </div>
              <span class="hidden md:block text-sm font-medium text-gray-700">管理员</span>
            </div>
          </div>
        </div>
      </header>

      <!-- 页面内容 -->
      <main class="flex-1 overflow-y-auto bg-gray-50">
        <div class="py-6">
          <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- 页面标题区域 -->
            <div class="mb-8">
              <div class="md:flex md:items-center md:justify-between">
                <div class="flex-1 min-w-0">
                  <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate">
                    账户分配
                  </h2>
                  <p class="mt-1 text-sm text-gray-500">
                    管理客户与广告账户的关系，分配广告账户给客户
                  </p>
                </div>
              </div>
            </div>

            <!-- 筛选区域 -->
            <div class="bg-white shadow-sm rounded-lg border border-gray-200 mb-6">
              <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">筛选条件</h3>
              </div>
              <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">客户ID</label>
                    <input type="text" id="filterCustomerId" placeholder="请输入客户ID" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">客户名称</label>
                    <input type="text" id="filterCustomerName" placeholder="请输入客户名称" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">广告账户ID</label>
                    <input type="text" id="filterAccountId" placeholder="请输入广告账户ID" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">广告账户名称</label>
                    <input type="text" id="filterAccountName" placeholder="请输入广告账户名称" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                  </div>
                  <div class="flex items-end">
                    <div class="flex space-x-2 w-full">
                      <button onclick="filterData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium transition-colors duration-200 flex-1">
                        <i class="fas fa-search mr-2"></i>搜索
                      </button>
                      <button onclick="resetFilter()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md font-medium transition-colors duration-200 flex-1">
                        <i class="fas fa-redo mr-2"></i>重置
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 操作栏和表格 -->
            <div class="bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden">
              <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-medium text-gray-900">已分配列表</h3>
                <div class="flex space-x-3">
                  <button id="batchUnbindBtn" onclick="batchUnbind()" disabled class="bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center space-x-2">
                    <i class="fas fa-unlink"></i>
                    <span>解除</span>
                  </button>
                  <button onclick="openModal('bindModal')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center space-x-2">
                    <i class="fas fa-link"></i>
                    <span>分配</span>
                  </button>
                  <button onclick="refreshData()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center space-x-2">
                    <i class="fas fa-sync"></i>
                    <span>刷新</span>
                  </button>
                </div>
              </div>

              <!-- 数据表格 -->
              <div class="table-container">
                <table class="fixed-table divide-y divide-gray-200 table-hover">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-6 py-3 text-left">
                        <input type="checkbox" id="selectAll" onchange="toggleSelectAll()" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                      </th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" style="width: 120px;">客户ID</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" style="width: 200px;">客户名称</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" style="width: 180px;">广告账户ID</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" style="width: 200px;">广告账户名称</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" style="width: 160px;">分配时间</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" style="width: 120px;">操作人</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200" id="dataTableBody">
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" class="row-checkbox rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" value="1">
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">C001</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">科技有限公司</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-mono">AD_ACT_123456789</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">科技公司广告账户</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024-01-15 10:30</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">admin</td>
                    </tr>
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" class="row-checkbox rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" value="2">
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">C002</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">创新科技公司</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-mono">AD_ACT_987654321</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">创新科技广告账户</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024-01-14 14:20</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">admin</td>
                    </tr>
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" class="row-checkbox rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" value="3">
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">C003</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">营销策划公司</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-mono">AD_ACT_456789123</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">营销策划广告账户</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024-01-13 09:15</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">admin</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- 分配账户模态框 -->
  <div id="bindModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-backdrop hidden z-50">
    <div class="flex items-center justify-center min-h-screen px-4">
      <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full animate-fadeIn">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-medium text-gray-900">分配广告账户</h3>
            <button onclick="closeModal('bindModal')" class="text-gray-400 hover:text-gray-600">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        <div class="px-6 py-4">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- 选择客户 -->
            <div>
              <h4 class="text-md font-medium text-gray-900 mb-4">选择客户（单选）</h4>
              <div class="border rounded-lg max-h-80 overflow-y-auto">
                <div class="p-3 border-b hover:bg-gray-50 cursor-pointer" onclick="selectCustomer('C001', '科技有限公司')">
                  <div class="flex items-center">
                    <input type="radio" name="customer" value="C001" class="mr-3">
                    <div>
                      <div class="font-medium">科技有限公司</div>
                      <div class="text-sm text-gray-500">C001</div>
                    </div>
                  </div>
                </div>
                <div class="p-3 border-b hover:bg-gray-50 cursor-pointer" onclick="selectCustomer('C002', '创新科技公司')">
                  <div class="flex items-center">
                    <input type="radio" name="customer" value="C002" class="mr-3">
                    <div>
                      <div class="font-medium">创新科技公司</div>
                      <div class="text-sm text-gray-500">C002</div>
                    </div>
                  </div>
                </div>
                <div class="p-3 hover:bg-gray-50 cursor-pointer" onclick="selectCustomer('C004', '电商运营公司')">
                  <div class="flex items-center">
                    <input type="radio" name="customer" value="C004" class="mr-3">
                    <div>
                      <div class="font-medium">电商运营公司</div>
                      <div class="text-sm text-gray-500">C004</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 选择广告账户 -->
            <div>
              <h4 class="text-md font-medium text-gray-900 mb-4">选择广告账户（多选）</h4>
              <div class="border rounded-lg max-h-80 overflow-y-auto">
                <div class="p-3 border-b hover:bg-gray-50">
                  <div class="flex items-center">
                    <input type="checkbox" value="AD_ACT_111111111" class="mr-3 account-checkbox">
                    <div>
                      <div class="font-medium">未分配账户1</div>
                      <div class="text-sm text-gray-500">AD_ACT_111111111</div>
                      <div class="text-xs text-green-600">可用</div>
                    </div>
                  </div>
                </div>
                <div class="p-3 border-b hover:bg-gray-50">
                  <div class="flex items-center">
                    <input type="checkbox" value="AD_ACT_222222222" class="mr-3 account-checkbox">
                    <div>
                      <div class="font-medium">未分配账户2</div>
                      <div class="text-sm text-gray-500">AD_ACT_222222222</div>
                      <div class="text-xs text-green-600">可用</div>
                    </div>
                  </div>
                </div>
                <div class="p-3 border-b hover:bg-gray-50">
                  <div class="flex items-center">
                    <input type="checkbox" value="AD_ACT_333333333" class="mr-3 account-checkbox">
                    <div>
                      <div class="font-medium">未分配账户3</div>
                      <div class="text-sm text-gray-500">AD_ACT_333333333</div>
                      <div class="text-xs text-green-600">可用</div>
                    </div>
                  </div>
                </div>
                <div class="p-3 hover:bg-gray-50 opacity-50">
                  <div class="flex items-center">
                    <input type="checkbox" value="AD_ACT_444444444" class="mr-3 account-checkbox" disabled>
                    <div>
                      <div class="font-medium">已分配账户1</div>
                      <div class="text-sm text-gray-500">AD_ACT_444444444</div>
                      <div class="text-xs text-red-600">已被客户C005占用</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
          <button onclick="closeModal('bindModal')" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors duration-200">
            取消
          </button>
          <button onclick="confirmBind()" class="px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 transition-colors duration-200">
            确认
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 解除确认模态框 -->
  <div id="unbindModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-backdrop hidden z-50">
    <div class="flex items-center justify-center min-h-screen px-4">
      <div class="bg-white rounded-lg shadow-xl max-w-md w-full animate-fadeIn">
        <div class="px-6 py-4 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-medium text-gray-900">确认</h3>
            <button onclick="closeModal('unbindModal')" class="text-gray-400 hover:text-gray-600">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        <div class="px-6 py-4">
          <p class="text-sm text-gray-500 mb-4">确定要解除选中的客户和广告账户吗？解除后，客户将无法在客户端看到该广告账户的信息。</p>
          <div id="unbindInfo" class="bg-gray-50 p-3 rounded text-sm"></div>
        </div>
        <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
          <button onclick="closeModal('unbindModal')" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors duration-200">
            取消
          </button>
          <button onclick="confirmUnbind()" class="px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 transition-colors duration-200">
            确认
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let selectedCustomer = null;
    let unbindData = null;

    // 移动端侧边栏控制
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      
      sidebar.classList.toggle('mobile-menu-closed');
      sidebar.classList.toggle('mobile-menu-open');
      
      if (sidebar.classList.contains('mobile-menu-open')) {
        overlay.classList.remove('hidden');
        overlay.classList.add('opacity-50');
      } else {
        overlay.classList.add('hidden');
        overlay.classList.remove('opacity-50');
      }
    }

    // 点击遮罩层关闭侧边栏
    document.getElementById('sidebar-overlay').addEventListener('click', function() {
      toggleSidebar();
    });

    // 模态框控制
    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.classList.remove('hidden');
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.classList.add('hidden');
      if (modalId === 'bindModal') {
        // 重置选择
        selectedCustomer = null;
        document.querySelectorAll('input[name="customer"]').forEach(radio => radio.checked = false);
        document.querySelectorAll('.account-checkbox').forEach(checkbox => checkbox.checked = false);
      }
    }

    // 点击模态框外部关闭
    document.addEventListener('click', function(event) {
      if (event.target.classList.contains('modal-backdrop')) {
        event.target.classList.add('hidden');
      }
    });

    // 全选/取消全选
    function toggleSelectAll() {
      const selectAllCheckbox = document.getElementById('selectAll');
      const rowCheckboxes = document.querySelectorAll('.row-checkbox');
      
      rowCheckboxes.forEach(checkbox => {
        checkbox.checked = selectAllCheckbox.checked;
      });
      
      updateBatchUnbindButton();
    }

    // 更新批量解除按钮状态
    function updateBatchUnbindButton() {
      const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
      const batchUnbindBtn = document.getElementById('batchUnbindBtn');
      
      batchUnbindBtn.disabled = checkedBoxes.length === 0;
    }

    // 监听行复选框变化
    document.addEventListener('change', function(event) {
      if (event.target.classList.contains('row-checkbox')) {
        updateBatchUnbindButton();
        
        // 更新全选状态
        const allCheckboxes = document.querySelectorAll('.row-checkbox');
        const checkedCheckboxes = document.querySelectorAll('.row-checkbox:checked');
        const selectAllCheckbox = document.getElementById('selectAll');
        
        if (checkedCheckboxes.length === 0) {
          selectAllCheckbox.indeterminate = false;
          selectAllCheckbox.checked = false;
        } else if (checkedCheckboxes.length === allCheckboxes.length) {
          selectAllCheckbox.indeterminate = false;
          selectAllCheckbox.checked = true;
        } else {
          selectAllCheckbox.indeterminate = true;
        }
      }
    });

    // 选择客户
    function selectCustomer(customerId, customerName) {
      selectedCustomer = { id: customerId, name: customerName };
      // 更新单选按钮状态
      document.querySelectorAll('input[name="customer"]').forEach(radio => {
        radio.checked = radio.value === customerId;
      });
    }

    // 筛选功能
    function filterData() {
      const customerId = document.getElementById('filterCustomerId').value;
      const customerName = document.getElementById('filterCustomerName').value;
      const accountId = document.getElementById('filterAccountId').value;
      const accountName = document.getElementById('filterAccountName').value;
      
      console.log('筛选条件：', { customerId, customerName, accountId, accountName });
      alert('筛选功能已触发，请查看控制台');
    }

    function resetFilter() {
      document.getElementById('filterCustomerId').value = '';
      document.getElementById('filterCustomerName').value = '';
      document.getElementById('filterAccountId').value = '';
      document.getElementById('filterAccountName').value = '';
      refreshData();
    }

    // 批量解除
    function batchUnbind() {
      const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
      if (checkedBoxes.length === 0) {
        alert('请选择要解除的记录');
        return;
      }
      
      unbindData = { count: checkedBoxes.length };
      document.getElementById('unbindInfo').innerHTML = `
        <div><strong>选中记录数:</strong> ${checkedBoxes.length}</div>
        <div class="text-red-600 mt-2">将解除所有选中的客户和广告账户关系</div>
      `;
      openModal('unbindModal');
    }

    // 确认解除
    function confirmUnbind() {
      alert(`已解除 ${unbindData.count} 条记录`);
      closeModal('unbindModal');
      refreshData();
    }

    // 确认分配
    function confirmBind() {
      if (!selectedCustomer) {
        alert('请选择客户');
        return;
      }
      
      const selectedAccounts = document.querySelectorAll('.account-checkbox:checked');
      if (selectedAccounts.length === 0) {
        alert('请选择至少一个广告账户');
        return;
      }
      
      const accountIds = Array.from(selectedAccounts).map(cb => cb.value);
      alert(`已将 ${accountIds.length} 个广告账户分配到客户 ${selectedCustomer.name}(${selectedCustomer.id})`);
      closeModal('bindModal');
      refreshData();
    }

    function refreshData() {
      console.log('数据已刷新');
      location.reload();
    }

    // 页面加载完成后的初始化
    document.addEventListener('DOMContentLoaded', function() {
      console.log('账户分配页面已加载');
      updateBatchUnbindButton();
    });
  </script>
</body>
</html> 